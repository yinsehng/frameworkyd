package com.neusoft.service.impl;

import java.util.ArrayList;
import java.util.List;
import java.util.Map;

import javax.annotation.Resource;

import org.springframework.stereotype.Service;

import com.neusoft.dao.IAC01Dao;
import com.neusoft.dao.IAa26Dao;
import com.neusoft.service.IAllPersonDetailCountService;
import com.neusoft.util.ConvertDataToRMUtil;
import com.neusoft.util.ResultModel;
import com.neusoft.util.SqlUtil;

@Service
public class AllPersonDetailCountServiceImpl implements IAllPersonDetailCountService{

	private static final String TITLE = "全市各地区参保人员统计";
	@Resource
	private IAC01Dao ac01Dao;
	@Resource
	public IAa26Dao aa26Dao;
	@Override
	public ResultModel getAllPersonDetCount() {
		String querySql = "select AAB299 SUBJECT,to_number(AKC023) AKC023,to_number(AKC024) AKC024 from (select AAB299," + 
                SqlUtil.getCommonSql() + ", sum(AAC006) AAC006 from JK_AC01" +
		          " group by AAB299, AKC021) pivot(sum(AAC006) for akc021 in('12' akc023,'13' akc024))";
		List<Object> list = ac01Dao.getSqlData(querySql);
		System.out.println("sql:" + querySql);
		ResultModel resultModel = ConvertDataToRMUtil.convertDataToModel(list);
		resultModel = convertRM(resultModel);
		resultModel.setTitle(TITLE);
		return resultModel;
	}
	
	private ResultModel convertRM(ResultModel resultModel) {
		Map<String, ArrayList> yAxis = resultModel.getyAxis();
		ArrayList list = yAxis.get("axis");
		for (int i = 0; i < list.size(); i++) {
			String code = (String)list.get(i);
			String name = aa26Dao.getProvinceNameByCode(code);
			/*if (name.contains("齐齐哈尔市")) {
				name = name.replace("齐齐哈尔市", "");
			}*/
			resultModel.getyAxis().get("axis").set(i, name);
		}
		return resultModel;
	}
	
}
