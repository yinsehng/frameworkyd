package com.neusoft.service.impl;

import java.util.HashMap;
import java.util.List;

import javax.annotation.Resource;

import org.springframework.stereotype.Service;

import com.neusoft.dao.IAa10Dao;
import com.neusoft.dao.IKc24Dao;
import com.neusoft.service.IRealtimeHospitalizeService;

@Service
public class RealtimeHospitalizeServiceImpl implements IRealtimeHospitalizeService{

	@Resource
	public IKc24Dao kc24Dao;
	@Resource
	public IAa10Dao aa10Dao;
	
	@Override
	public List getRealtimeHospitalize() {
		String sql = " select *from (select AAC003,AKA130,AKB021,JK_KC24.AAE036 from JK_KC24,JK_KC02 where JK_KC24.AAC001 = JK_KC02.AAC001  order by aae036 desc) where rownum <= 8";
		List list = kc24Dao.getSqlData(sql);
		list = convertList(list);
		return list;
	}

	private List convertList(List list) {
		for (Object  obj : list) {
			HashMap<String, Object> map = (HashMap<String, Object>)obj;
			String AAE036 = map.get("AAE036").toString();
			if (AAE036 != null && AAE036.contains(".0")) {
				int position = AAE036.indexOf(".0");
				map.put("AAE036", AAE036.substring(0, position));
			}
			String AKA130 = map.get("AKA130").toString();
			String codeName = aa10Dao.getNameByCode("AKA130", AKA130);
			map.put("AKA130", codeName);
		}
		return list;
	}

}
