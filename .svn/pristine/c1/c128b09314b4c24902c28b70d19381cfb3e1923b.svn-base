<%@ page language="java" import="java.util.*" pageEncoding="utf-8" contentType="text/html; charset=utf-8"%>
<% 
    String path = request.getContextPath();
    String basePath = request.getScheme()+"://"+request.getServerName()+":"+request.getServerPort()+path+"/";
    //获取数据
	String enregisterOrder_json = (String)request.getAttribute("enregisterOrder");
%> 
<!-- 备案登记排行 -->
<div style="width: auto; height: auto;">
    <!-- 为ECharts准备一个具备大小（宽高）的Dom -->
    <div id="enregister_order" style="height:100%;width:100%"></div>
    <script type="text/javascript">
    // 基于准备好的dom，初始化echarts图表
    var enregisterOrder_json = <%= enregisterOrder_json%>;
    var myChartEnregisterOrder = echarts.init(document.getElementById("enregister_order")); 

    flushEnregisterOrder(enregisterOrder_json);
    //此处调用定时任务
    $(document).ready(function () {
    	setInterval("getEnregisterOrderByAjax()", 100000);
    });
    //定义getDiseasesOrderByAjax函数
    function getEnregisterOrderByAjax() {
    	if(autoflag!=1){
			return;
		}
    	$.ajax( {  
    	    url:'<%=basePath %>ActionServlet?method=enregisterOrderAction&ajax=true',
    	    data:{},  
    	    type:'GET',
    	    cache:false, 
    	    dataType:'json',
    	    success:function(resultmodel) {
    	        if(resultmodel.code =="200" ){
    	        	flushEnregisterOrder(resultmodel);
    	        }
    	     },
    	     error : function() {
    	         if (resultmodel.code =="500"){
    	        	  alert(resultmodel.message);
    	         }
    	     }
    	});
    }
   
    function flushEnregisterOrder(enregisterOrder_json) {
    	   
    	
    	option = {
    			title: {
    		        text: enregisterOrder_json.title,
    		        sublink: 'http://www.neusoft.com',
    		        left: 'center',
    		        textStyle: {
    		            color: '#fff'
    		        } 
    		    },
    		    tooltip : {
    		        trigger: 'axis',
    		        axisPointer : {            // 坐标轴指示器，坐标轴触发有效
    		            type : 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
    		        }
    		    },
    		    calculable : true,
    		    xAxis : [
    		        {
    		            type : 'value',
    		            axisLine:{
    		                lineStyle:{
    		                    color:'#fff',
    		                }
    		            }
    		        }
    		    ],
    		    yAxis : [
    		        {
    		            type : 'category',
    		            data : enregisterOrder_json.yAxis.转出,
    		            axisLabel:{
      		              textStyle:{
      		                 color:"#fff", //刻度颜色
      		               
      		            }
      		          },
      				  axisLine:{
      		                lineStyle:{
      		                    color:'#fff',
      		                }
      		            }
    		        }
    		    ],
    		    series : [
    		        {
    		            name:'转入',
    		            type:'bar',
    		            stack: '总量',
    		            itemStyle : { 
    		            	normal: {
    		            		label : {
    		            			show: false, 
    		            			position: 'insideRight'
    		            			},
    		            		barBorderRadius: [30, 0, 0,30],
    		            		color:new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
					                        offset: 0,
					                        color: '#e25041'
					                    }, {
					                        offset: 1,
					                        color: '#ffb275'
					                    }]),
    		        		}
    		        },
    		            data:enregisterOrder_json.series.转入
    		        },
    		        {
    		            name:'转出',
    		            type:'bar',
    		            stack: '总量',
    		            itemStyle : { 
    		            	normal: {
    		            		label : {
    		            			show: false, 
    		            			position: 'insideRight'
    		            			},
    		            			barBorderRadius: [0, 30, 30,0],
    		            			
    		            		color:new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
					                        offset: 0,
					                        color: '#00c7ab'
					                    }, {
					                        offset: 1,
					                        color: '#75e1c2'
					                    }]),
    		                }
    		            },
    		            data:enregisterOrder_json.series.转出
    		        }
    		    ]
    		};
    	
    	
    	/* option = {
    		    title: {
    		        text: enregisterOrder_json.title,
    		        sublink: 'http://www.neusoft.com',
    		        left: 'center',
    		        textStyle: {
    		            color: '#fff'
    		        }
    		    },
    		    tooltip: {
    		        trigger: 'axis',
    		        axisPointer: {
    		            type: 'shadow'
    		        }
    		    },
    		 
    		    grid: {
    		        left: '3%',
    		        right: '4%',
    		        bottom: '3%',
    		        containLabel: true
    		    },
    		    xAxis: {
    		        type: 'value',
    		        boundaryGap: [0, 0.01],
    				axisLine:{
    		                lineStyle:{
    		                    color:'#fff',
    		                }
    		            }
    		    },
    		     xAxis: {
    		        type: 'value',
    		        boundaryGap: [0, 0.01],
    				axisLine:{
    		                lineStyle:{
    		                    color:'#fff',
    		                  
    		                }
    		            }
    		    },
    		    yAxis: {
    		        type: 'category',
    		        data: enregisterOrder_json.yAxis.转出,
    				 axisLabel:{
    		              textStyle:{
    		                 color:"#fff", //刻度颜色
    		               
    		            }
    		          },
    				  axisLine:{
    		                lineStyle:{
    		                    color:'#fff',
    		                }
    		            }
    		    },
    		    series: [
    		        {
    		            name: '转入',
    		            type: 'bar',
    					barWidth : 5,
    		            data: enregisterOrder_json.series.转入
    					
    		        },
    				 {
    		            name: '转出',
    		            type: 'bar',
    		            data: enregisterOrder_json.series.转出
    		        }
    		      
    		    ]
    		}; */
                        
            // 为echarts对象加载数据 
          //  myChart.clean();
            myChartEnregisterOrder.setOption(option); 
    }
    
    </script>
</div>

