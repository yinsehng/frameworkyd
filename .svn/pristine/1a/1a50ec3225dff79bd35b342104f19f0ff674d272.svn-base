<%@page import="java.text.SimpleDateFormat,java.text.DecimalFormat"%>
<%@ include file="../public/base.jsp"%>

<%
	
	DecimalFormat  df= new DecimalFormat("######0.00");  

	String total_money = (String)request.getAttribute("total_money");
	String[] tot=total_money.split("\\&");
	double total;
	if(tot.length>2){
		total=Double.parseDouble(tot[0])+Double.parseDouble(tot[1]);
	}else{
		total=Double.parseDouble(tot[0]);
	}
	

	String banance_number = (String)request.getAttribute("banance_number");
	String[] ban=banance_number.split("\\&");
	
	int bana;
	if(ban.length>2){
		bana=Integer.parseInt(ban[0])+Integer.parseInt(ban[1]);
	}else{
		bana=Integer.parseInt(ban[0]);
	}
	
	String enregister_number = (String)request.getAttribute("enregister_number");
	String[] enr=enregister_number.split("\\&");
	int enre;
	if(enr.length>2){
		enre=Integer.parseInt(ban[0])+Integer.parseInt(ban[1]);
	}else{
		enre=Integer.parseInt(ban[0]);
	}
%>

<body style="background-image: url('<%=basePath%>static/images/bg.jpg');"> 
		<script type="text/javascript">
		var autoflag=1;
		function setAuto(){
			if($("#checkAuto").is(":checked")) {
				setAutoOn();
			}else{
				setAutoOff();
			}
		}
		function setAutoOff(){
			autoflag=0;
			$("#checkAuto").attr("checked", false);
		}
		function setAutoOn(){
			autoflag=1;
			$("#checkAuto").attr("checked", true);
		}
			$(document).ready(function(){
	        	//$('.counter').countUp();
	        	$("#myslider_keleyi_com").myslider({ "width": "400px"
	        	        , "millisec": "2000"
	        	        , "animatespeed": 800
	        	        , "fontSize": "20px"
	        	        , "li_style": {"font-size":"20px"}
	        	 });
	    	});
			$(document).ready(function () {
		        setInterval("getRealtimeDataByAjax()", 10000);
		    });
			$(function() {
				$('a[href="#ex1"]').click(function(event){
				  event.preventDefault();
				  $(this).modal({
				    closeClass: 'icon-remove',
				    closeText: '!'
				  });
				});
				
				$('a[href="#ex2"]').click(function(event){
				  	//$('.counter').countUp();
					event.preventDefault();
				  	$(this).modal({
				   		closeClass: 'icon-remove',
				    	closeText: '!'
				  	});
				});
				
				$('#search').click(function(){
					setAutoOff();
					var begintime = $('#d4311').val();
					var endtime = $('#d4312').val();
					var date = begintime + "至" + endtime;
					$('.date').text(date);
					if (begintime == null && endtime == null) {
						return ;
					}
					jQuery.modal.close();
					$.ajax( {  
		        	    url:'<%=basePath %>ActionServlet?method=indexAction&ajax=true',
		        	    data:{
		        	    	beginTime : begintime,
		        	    	endTime: endtime
		        	    },  
		        	    type:'POST',
		        	    cache:false, 
		        	    dataType:'json',
		        	    success:function(data) {
		        	    	var tts=data.total_money.split("&");
					    	if(tts.length == 2){ tts[1]=0; } 
		        	    	var totm=parseFloat(tts[0]==""?"0":tts[0])+parseFloat(tts[1]==""?"0":tts[1]);
		        	    	if(tts.length>2){
			        	    	$('.total_money1').text("转入："+ (tts[0]/10000).toFixed(2) );//转入
			        	    	$('.total_money2').text("转出："+ (tts[1]/10000).toFixed(2) );//转出
		        	    	}
		        	    	$('.total_money').text( (totm/10000) );
		        	    	
		        	    	var bass=data.banance_number.split("&");
		        	    	if(bass.length == 2){ bass[1]=0; } 
		        	    	var bana=parseInt(bass[0]==""?"0":bass[0])+parseInt(bass[1]==""?"0":bass[1]);
		        	    	if(bass.length >2){
			        	    	$('.banance_number1').text("转入："+ bass[0] );//转入
			        	    	$('.banance_number2').text("转出："+ bass[1] );//转出
		        	    	}
		        	    	$('.banance_number').text(bana );
		        	    	
		        	    	var enss=data.enregister_number.split("&");
		        	    	if(enss.length == 2){ enss[1]=0; } 
		        	    	var enr=parseInt(enss[0]==""?"0":enss[0])+parseInt(enss[1]==""?"0":enss[1]);
		        	    	if(enss.length > 2){
		        	    		$('.enregister_number1').text("转入："+ enss[0] );//转入
		        	    		$('.enregister_number2').text("转出："+ enss[1] );//转出
		        	   		 }
		        	    	$('.enregister_number').text(enr);
		        	        flushDiseasesOrder(eval('(' + data.diseasesOrder_json + ')'));
		        	        flushBusinessMoney(eval('(' + data.businessMoney_json + ')'));
		        	        //flushElsewhereHospitalize(eval('(' + data.elsewhereHospitalize_json + ')'));
		        	        flushlsEwherePerson(eval('(' + data.elsewherePerson_json + ')'));
		        	        flushEnregisterOrder(eval('(' + data.enregisterOrder_json + ')'));
		        	     }
		        	});
				});
			});
			
			
			function showOnlyData(name){
				setAutoOff();
				$.ajax( {  
				    url:'<%=basePath %>ActionServlet?method=indexAction&ajax=true',
				    data:{
				    	localName :name  
				    },  
				    type:'POST',
				    cache:false, 
				    dataType:'json',
				    success:function(data) {
				    	var tts=data.total_money.split("&");
				    	if(tts.length == 2){ tts[1]=0; } 
	        	    	var totm=parseFloat(tts[0]==""?"0":tts[0])+parseFloat(tts[1]==""?"0":tts[1]);
	        	    	if(tts.length>2){
		        	    	$('.total_money1').text("转入："+ (tts[0]/10000).toFixed(2) );//转入
		        	    	$('.total_money2').text("转出："+ (tts[1]/10000).toFixed(2) );//转出
	        	    	}
	        	    	$('.total_money').text( (totm/10000) );
	        	    	
	        	    	var bass=data.banance_number.split("&");
	        	    	if(bass.length == 2){ bass[1]=0; } 
	        	    	var bana=parseInt(bass[0]==""?"0":bass[0])+parseInt(bass[1]==""?"0":bass[1]);
	        	    	if(bass.length >2){
		        	    	$('.banance_number1').text("转入："+ bass[0] );//转入
		        	    	$('.banance_number2').text("转出："+ bass[1] );//转出
	        	    	}
	        	    	$('.banance_number').text(bana );
	        	    	
	        	    	var enss=data.enregister_number.split("&");
	        	    	if(enss.length == 2){ enss[1]=0; } 
	        	    	var enr=parseInt(enss[0]==""?"0":enss[0])+parseInt(enss[1]==""?"0":enss[1]);
	        	    	if(enss.length > 2){
	        	    		$('.enregister_number1').text("转入："+ enss[0] );//转入
	        	    		$('.enregister_number2').text("转出："+ enss[1] );//转出
	        	   		 }
	        	    	$('.enregister_number').text(enr);
				        flushDiseasesOrder(eval('(' + data.diseasesOrder_json + ')'));
				        flushBusinessMoney(eval('(' + data.businessMoney_json + ')'));
				        flushlsEwherePerson(eval('(' + data.elsewherePerson_json + ')'));
				        flushEnregisterOrder(eval('(' + data.enregisterOrder_json + ')'));
				         
				     }
				});
			}
			function clearindex(){
				
				$('.indexnum').text("");
			}
			
			function getRealtimeDataByAjax() {
				if(autoflag!=1){
					return;
				}
				$.ajax( {  
	        	    url:'<%=basePath %>ActionServlet?method=indexAction&ajax=true',
	        	    data:{
	        	    	flag : 'realtimedata'
	        	    },  
	        	    type:'POST',
	        	    cache:false, 
	        	    dataType:'json',
	        	    success:function(data) {
	        	    	var tts=data.total_money.split("&");
				    	if(tts.length == 2){ tts[1]=0; } 
	        	    	var totm=parseFloat(tts[0]==""?"0":tts[0])+parseFloat(tts[1]==""?"0":tts[1]);
	        	    	if(tts.length>2){
		        	    	$('.total_money1').text("转入："+ (tts[0]/10000).toFixed(2) );//转入
		        	    	$('.total_money2').text("转出："+ (tts[1]/10000).toFixed(2) );//转出
	        	    	}
	        	    	$('.total_money').text( (totm/10000) );
	        	    	
	        	    	var bass=data.banance_number.split("&");
	        	    	if(bass.length == 2){ bass[1]=0; } 
	        	    	var bana=parseInt(bass[0]==""?"0":bass[0])+parseInt(bass[1]==""?"0":bass[1]);
	        	    	if(bass.length >2){
		        	    	$('.banance_number1').text("转入："+ bass[0] );//转入
		        	    	$('.banance_number2').text("转出："+ bass[1] );//转出
	        	    	}
	        	    	$('.banance_number').text(bana );
	        	    	
	        	    	var enss=data.enregister_number.split("&");
	        	    	if(enss.length == 2){ enss[1]=0; } 
	        	    	var enr=parseInt(enss[0]==""?"0":enss[0])+parseInt(enss[1]==""?"0":enss[1]);
	        	    	if(enss.length > 2){
	        	    		$('.enregister_number1').text("转入："+ enss[0] );//转入
	        	    		$('.enregister_number2').text("转出："+ enss[1] );//转出
	        	   		 }
	        	    	$('.enregister_number').text(enr);
	        	     }
	        	});
			}
		</script>
		
		<div id="ex1" style="display:none;background-color:#E0EEED;height:70px;width:420px;opacity:0.8;filter:alpha(opacity=50);z-index: 1001">
    		<div class="font-style">查询条件：</div>
    		<div style="margin-top: 5px;font-size: 2px;" class="font-style">
    			开始：<input id="d4311" class="Wdate" name="begintime" type="text" onFocus="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss',maxDate:'#F{$dp.$D(\'d4312\')||\'2020-10-01\'}'})"/> 
				至<input id="d4312" class="Wdate" name="endtime" style="margin-left: 5px;" type="text" onFocus="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss',minDate:'#F{$dp.$D(\'d4311\')}',maxDate:'2020-10-01'})"/>
    		</div>
    		<div style="margin-left: 415px;margin-top: -17px;"><img id="search" style="width: 15px;height: 15px;cursor: pointer" alt="搜索" title="搜索" src="<%=basePath %>static/images/search.png"></div>
    		<div class="font-style" style="margin-top: 8px;">自动更新：<input type="checkbox" onclick="setAuto()" id="checkAuto" checked="checked"/></div>
  		</div>
  		
  		<div id="ex2" style="display:none;background-color:#E0EEED;height:370px;width:400px;opacity:0.8;filter:alpha(opacity=50);z-index: 1001">
			 <div  style="color:#FFF;line-height: 40px">
			 	<ul>
				    <li><span style="color: #f60;font-weight: bold;">支付金额(单位：万元) ：</span><span class="total_money" style="color: #f60"><%=df.format((Double.parseDouble(tot[0])/10000 )) %></span><span class="total_money1 counter" style="color: #000;">转出：</span></li>
				    <li><span class="total_money2 counter" style="color: #000;">转入： </span></li>
				    <li><span style="color: #f60;font-weight: bold;">结算人次：</span><span class="banance_number" style="color: #f60"><%=ban[0] %></span><span class="banance_number1 counter" style="color: #000;">转出：</span></li>
				    <li><span class="banance_number2 counter" style="color: #000;">转入： </span></li>
				    <li><span style="color: #f60;font-weight: bold;">备案人数：</span><span class="enregister_number" style="color: #f60"><%=enr[0] %></span><span class="enregister_number1 counter"  style="color: #000;">转出：</span></li>
				    <li><span class="enregister_number2 counter"  style="color: #000;">转出： </span></li>
				</ul>
			</div>
  		</div>
  		
  		<div style="width:97%;  margin:0px auto; height:100%;position:relative;  " class="jb">
  			<div style="font-size: 35px; text-align: center; color: white; font-weight: bold;">吉林省省内异地就医监控平台
  			<div style="  text-align: center;color: #aaa;font-weight: bold;font-size: 14px;z-index: 1800">数据时间:<a href="#ex1" rel="modal:open" style="color: #aaa;" class="date">2013-01-01 00:00至<%=new SimpleDateFormat("yyyy-MM-dd HH:mm").format(new Date())   %></a></div>
  			<div id="myslider_keleyi_com" class="keleyimyslider" style="margin:0px auto;text-align: center; top: 60px; z-index: 1800">
				<a href="#ex2" rel="modal:open">
				<ul>
				    <li><span style="color: rgb(248, 188, 56);font-weight: bold;">支付金额 ：</span><span class="total_money" style="color: #fff;">￥<%=total/10000 %></span><span style="color: white;">万元</span></li>
				    <li><span style="color: rgb(248, 188, 56);font-weight: bold;">结算人次：</span><span class="banance_number" style="color: #fff;"><%=bana %></span></li>
				    <li><span style="color: rgb(248, 188, 56);font-weight: bold;">备案人数：</span><span class="enregister_number" style="color: #fff;"><%=enre %></span></li>
				</ul>
				</a>
			</div>
  			
  			</div>
  			
			<div style="width:100%; height:65%;position:relative;">
		    	
		        <div style="width:72%; height:100%; float:left;z-index: 2000;" class="jb">
		        	
					
					<!-- 数据迁移地图页面 -->
						<jsp:include page="dataTransferMap.jsp" />
				</div>
				<div style=" width:27%; height:100%; float:left;" class="jb">
		        	<div class="jb" style="height: 50%"><jsp:include page="hx.jsp" /></div>
		            <div class="jb" style="height: 50%"><jsp:include page="diseasesOrder.jsp" /></div>
		        </div>
		        <div style="clear:both;"></div>
		    </div>
		    
		    
		    <div style="width:100%; height:32%;">
		    	<div  class="jb" style=" width:27%; height:100%; float:left;" ><jsp:include page="elsewherePerson.jsp" /></div>
		        <div class="jb" style=" width:45%; height:100%; float:left;"><jsp:include page="enregisterOrder.jsp" /></div>
		        <div class="jb" style=" width:27%; height:100%; float:left;"><jsp:include page="businessMoney.jsp" /></div>
		        <div style="clear:both;"></div>
		    </div>
		  </div>
  		
  		
  		
		
		
 
	</body>
</html>
