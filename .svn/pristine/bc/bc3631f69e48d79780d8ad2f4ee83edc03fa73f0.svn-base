<%@ page language="java" import="java.util.*" pageEncoding="utf-8" contentType="text/html; charset=utf-8"%>
<% 
    String path = request.getContextPath();
    String basePath = request.getScheme()+"://"+request.getServerName()+":"+request.getServerPort()+path+"/";
    //获取数据
	String elsewhereHospitalize_json = (String)request.getAttribute("elsewhereHospitalize_json");
%>
<!-- 异地就医 页面定义 -->
<div style="width: 100%; height: 100%;">
	<!-- 为ECharts准备一个具备大小（宽高）的Dom -->
	<div id="elsewhere_hospitalize" style="height:100%;width:100%"></div>
	<!-- ECharts单文件引入 -->
	<script type="text/javascript">
        // 基于准备好的dom，初始化echarts图表
        var myChartelsewhereHospitalize = echarts.init(document.getElementById('elsewhere_hospitalize')); 
        var elsewhereHospitalize_json = <%= elsewhereHospitalize_json %>;
        
        flushElsewhereHospitalize(elsewhereHospitalize_json);
        //此处调用定时任务
        $(document).ready(function () {
        	setInterval("getElsewhereHospitalizeByAjax()", 100000);
        });
        //定义getDiseasesOrderByAjax函数
        function getElsewhereHospitalizeByAjax() {
        	if(autoflag!=1){
				return;
			}
        	$.ajax( {  
        	    url:'<%=basePath %>ActionServlet?method=elsewhereHospitalizeAction&ajax=true',
        	    data:{},  
        	    type:'GET',
        	    cache:false, 
        	    dataType:'json',
        	    success:function(resultmodel) {
        	        if(resultmodel.code =="200" ){
        	        	flushElsewhereHospitalize(resultmodel);
        	        }
        	     },
        	     error : function() {
        	         if (resultmodel.code =="500"){
        	        	  alert(resultmodel.message);
        	         }
        	     }
        	});
        }
        
        function flushElsewhereHospitalize(elsewhereHospitalize_json) {
        	var provinces = elsewhereHospitalize_json.yAxis.provinces;
            //求出两个数据列表最大是，并对其进行向上取整
            var max = getMaxNum(elsewhereHospitalize_json);
            var data = "";
            if (provinces != null) {
            	data += "[";
            	for (var i = 0; i < provinces.length; i++) {
            		data += "{ name: '" + provinces[i] + "',max:"+ max +"},"
                }
            	data += "]";
            }
            data = eval('(' + data + ')');
            
    		option = {
    		    title: {
    		        text: elsewhereHospitalize_json.title,
    		        sublink: 'http://www.neusoft.com',
    		        x: 'left',
    		        textStyle: {
    		            color: '#fff'
    		        }
    		    },
    		    
    		    tooltip: {},
    		    radar: {
    		        // shape: 'circle',
    		        indicator:data,
    		         axisLine:{
		        		lineStyle:{
		        				color:'#fff'//坐标轴轴线的颜色
		        		}
		        	},
		        	splitLine:{
        			lineStyle:{
        					color:'#fff'//坐标轴在 grid 区域中的分隔线
        				}
        			},
        			splitArea:{
        			areaStyle:{
        					color:['rgba(250,250,250,0.1)','rgba(200,200,200,0.1)']//区域颜色数组区分
        				}
        			},
    		    },
    		    series: [{
    		        name: '转入 vs 转出',
    		        type: 'radar',
    		        // areaStyle: {normal: {}},
    		        itemStyle: {normal: {areaStyle: {type: 'default'}}},
    		        data : [
    		            {
    		                value : elsewhereHospitalize_json.series.转入,
    		                name : '转入',
    		                label: {
    		                        normal: {
    		                            show: true,
    		                            formatter:function(params) {
    		                                return params.value;
    		                            }
    		                        }
    		                },
    		                areaStyle: {normal: {color:'#C58369'}}
    		            },
    		             {
    		                value : elsewhereHospitalize_json.series.转出,
    		                name : '转出',
    		                label: {
    		                        normal: {
    		                            show: true,
    		                            formatter:function(params) {
    		                                return params.value;
    		                            }
    		                        }
    		                },
    		                areaStyle: {normal: {color:'#11CAAF'}}
    		            }
    		        ]
    		    }]
    		};
            // 为echarts对象加载数据 
            myChartelsewhereHospitalize.setOption(option);
        }
        
        function getMaxNum(elsewhereHospitalize_json) {
        	var data_in = elsewhereHospitalize_json.series.转入;
        	var data_out = elsewhereHospitalize_json.series.转出;
        	var num_in = getMax(data_in);
        	var num_out = getMax(data_out);
        	if (num_in > num_out) {
        		return Math.ceil(num_in);
        	} else {
        		return Math.ceil(num_out);
        	}
        }
        function getMax(data) {
        	var tem = data[0];
        	for (var i = 0; i < data.length; i++) {
        		if  (data[i] > tem) {
        			tem = data[i];
        		}
        	}
        	return tem;
        }
    </script>
</div>
